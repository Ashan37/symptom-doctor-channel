generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role{
  PATIENT
  DOCTOR
  ADMIN
}

enum Urgency{
  LOW
  MEDIUM
  HIGH
}

model User{
  id String @id @default(cuid())
  name String?
  email String @unique
  password String
  role Role @default(PATIENT)
  createdAt DateTime @default(now())
  patient Patient?
  doctor Doctor?
  admin Admin?
}

model Patient{
  id String @id @default(cuid())
  userId String @unique
  user User @relation(fields:[userId], references:[id])
  symptoms Symptom[]
  consultations Consultation[]
  medicalReports MedicalReport[]
}

model Doctor{
  id String @id @default(cuid())
  userId String @unique
  user User @relation(fields:[userId], references:[id])
  specialization String?
  availability Availability[]
  consultations Consultation[] 
}

model Admin{
  id String @id @default(cuid())
  userId String @unique
  user User @relation(fields:[userId], references:[id])
}

model Symptom {
id String @id @default(cuid())
patientId String
patient Patient @relation(fields: [patientId], references: [id])
title String?
description String
aiResult Json?
urgency Urgency @default(LOW)
createdAt DateTime @default(now())
}

model Consultation {
id String @id @default(cuid())
patientId String
doctorId String
patient Patient @relation(fields: [patientId], references: [id])
doctor Doctor @relation(fields: [doctorId], references: [id])
diagnosis String?
prescription String?
createdAt DateTime @default(now())
chats Chat[]
}

model Chat {
id String @id @default(cuid())
consultationId String
senderRole Role
message String
createdAt DateTime @default(now())
consultation Consultation @relation(fields: [consultationId], references: [id])
}

model Availability {
id String @id @default(cuid())
doctorId String
day String
startTime String
endTime String
doctor Doctor @relation(fields: [doctorId], references: [id])
}

model MedicalReport {
id String @id @default(cuid())
patientId String
type String
fileUrl String
createdAt DateTime @default(now())
patient Patient @relation(fields: [patientId], references: [id])
}

model Channel {
  id         String    @id @default(cuid())
  patientId  String
  doctorId   String
  createdAt  DateTime  @default(now())

  patient    Patient   @relation(fields: [patientId], references: [id])
  doctor     Doctor    @relation(fields: [doctorId], references: [id])
  messages   Message[]
}

model Message {
  id         String    @id @default(cuid())
  channelId  String
  senderId   String   // user ID
  content    String
  createdAt  DateTime @default(now())

  channel    Channel  @relation(fields: [channelId], references: [id])
}